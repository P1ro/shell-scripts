#!/usr/bin/env bats


# Make executables ./tests/../ visible to PATH
PATH="/home/aveey/tom-project/shell-scripts/tests/../:$PATH"

# Enable aliases
shopt -s expand_aliases



@test "test-1" {
	testfolder="/tmp/batspp-30032/test-1"
	mkdir --parents "$testfolder"
	cd "$testfolder" || echo Warning: Unable to "cd $testfolder"

	echo "==========" $'alias testuser="sed -r "s/"$USER"+/userxf333/g""\n' "=========="
	test-1-actual 
	echo "=========" $'$ alias testnum="sed -r "s/[0-9]/N/g"" \n\n$ echo "Hi Mom!"\nHi Mom!\n\n$ echo \'Hello world\' | wc -l\n1\n\n$ pwd | testuser\n/home/userxf333/tom-project/shell-scripts/tests\n\n# THIS IS A COMMENT\n\n$ which systemd\n/usr/bin/systemd\n\n$ man date | head -n 10 | testnum\nDATE(N)                          User Commands                         DATE(N)\n\nNAME\n       date - print or set the system date and time\n\nSYNOPSIS\n       date [OPTION]... [+FORMAT]\n       date [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]\n\nDESCRIPTION\n\n# awk will be used to remove any factors that may cause an error\n$ ps -l | awk \'!($3=$4=$5=$10=$13="")\' | testnum\nF S    C PRI NI ADDR  WCHAN TTY  CMD\nN S    N NN N -  do_wai pts/N  bash\nN R    N NN N -  - pts/N  ps\nN S    N NN N -  pipe_r pts/N  awk\nN S    N NN N -  pipe_r pts/N  sed\n\n$ ps | head -n 10 | testuser | testnum\n    PID TTY          TIME CMD\n  NNNNN pts/N    NN:NN:NN bash\n  NNNNN pts/N    NN:NN:NN ps\n  NNNNN pts/N    NN:NN:NN head\n  NNNNN pts/N    NN:NN:NN sed\n  NNNNN pts/N    NN:NN:NN sed' "========="
	test-1-expected 
	echo "============================"
	# ???: 'alias testuser="sed -r "s/"$USER"+/userxf333/g""\n'=$(test-1-actual)
	# ???: '$ alias testnum="sed -r "s/[0-9]/N/g"" \n\n$ echo "Hi Mom!"\nHi Mom!\n\n$ echo \'Hello world\' | wc -l\n1\n\n$ pwd | testuser\n/home/userxf333/tom-project/shell-scripts/tests\n\n# THIS IS A COMMENT\n\n$ which systemd\n/usr/bin/systemd\n\n$ man date | head -n 10 | testnum\nDATE(N)                          User Commands                         DATE(N)\n\nNAME\n       date - print or set the system date and time\n\nSYNOPSIS\n       date [OPTION]... [+FORMAT]\n       date [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]\n\nDESCRIPTION\n\n# awk will be used to remove any factors that may cause an error\n$ ps -l | awk \'!($3=$4=$5=$10=$13="")\' | testnum\nF S    C PRI NI ADDR  WCHAN TTY  CMD\nN S    N NN N -  do_wai pts/N  bash\nN R    N NN N -  - pts/N  ps\nN S    N NN N -  pipe_r pts/N  awk\nN S    N NN N -  pipe_r pts/N  sed\n\n$ ps | head -n 10 | testuser | testnum\n    PID TTY          TIME CMD\n  NNNNN pts/N    NN:NN:NN bash\n  NNNNN pts/N    NN:NN:NN ps\n  NNNNN pts/N    NN:NN:NN head\n  NNNNN pts/N    NN:NN:NN sed\n  NNNNN pts/N    NN:NN:NN sed'=$(test-1-expected)
	[ "$(test-1-actual)" == "$(test-1-expected)" ]
}

function test-1-actual () {
	# no-op in case content just a comment
	true

	alias testuser="sed -r "s/"$USER"+/userxf333/g""

}

function test-1-expected () {
	# no-op in case content just a comment
	true

	cat <<END_EXPECTED
$ alias testnum="sed -r "s/[0-9]/N/g"" 

$ echo "Hi Mom!"
Hi Mom!

$ echo 'Hello world' | wc -l
1

$ pwd | testuser
/home/userxf333/tom-project/shell-scripts/tests

# THIS IS A COMMENT

$ which systemd
/usr/bin/systemd

$ man date | head -n 10 | testnum
DATE(N)                          User Commands                         DATE(N)

NAME
       date - print or set the system date and time

SYNOPSIS
       date [OPTION]... [+FORMAT]
       date [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]

DESCRIPTION

# awk will be used to remove any factors that may cause an error
$ ps -l | awk '!($3=$4=$5=$10=$13="")' | testnum
F S    C PRI NI ADDR  WCHAN TTY  CMD
N S    N NN N -  do_wai pts/N  bash
N R    N NN N -  - pts/N  ps
N S    N NN N -  pipe_r pts/N  awk
N S    N NN N -  pipe_r pts/N  sed

$ ps | head -n 10 | testuser | testnum
    PID TTY          TIME CMD
  NNNNN pts/N    NN:NN:NN bash
  NNNNN pts/N    NN:NN:NN ps
  NNNNN pts/N    NN:NN:NN head
  NNNNN pts/N    NN:NN:NN sed
  NNNNN pts/N    NN:NN:NN sed
END_EXPECTED
}
